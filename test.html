<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Test Synth</title>
  <!-- 加载 Tone.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.39/Tone.js"></script>
</head>
<body>
  <h1>PolySynth Test</h1>
  <button id="testBtn">Test Synth</button>

  <script>
    document.getElementById("testBtn").addEventListener("click", async () => {
      try {
        // 1) 解锁 AudioContext（在用户交互里才能播放音频）
        await Tone.start();
        console.log("AudioContext unlocked.");

        // 2) 设置一个调度事件
        //    每次点击先清除已有的调度
        Tone.Transport.cancel();

        // 安排在当前时间 + 0.5 秒后，播放 C4 音。
        Tone.Transport.schedule(time => {
          const synth = new Tone.PolySynth(Tone.Synth).toDestination();
          synth.triggerAttackRelease("C4", "1n", time);
          console.log("Scheduled C4 at time:", time);
        }, "+0.5");

        // 3) 启动 Transport
        Tone.Transport.start();
        console.log("Transport started.");

      } catch (err) {
        console.error("Error testing synth:", err);
      }
    });
  </script>
</body>
</html>